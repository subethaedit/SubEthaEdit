<?Lassoscript// Last modified 11/24/10 by ECL, Landmann InterActive// FUNCTIONALITY// Used to edit System Info// CHANGE NOTES// 10/12/07// Recoded for CMS v. 3.0// 8/24/09// Adding fields for image utilities and css// Fix a logic problem with error display// 11/2/09// Made the SEO Tailoring and Page Settings panels expandable// 12/9/09// Added GoogleTracker field// 11/24/10// Added check against $svCSSIgnoreArray for stylesheets to ignore when creating stylesheet select list// Defining the DataTypeVar:'vDataType' = 'Sys';// Convert action_paramsInclude:'sys_params.inc';// If Process = Y, form was submit, so update the record// Otherwise, it is a new edit so get the recordIf: $vProcess != 'Y';	// Get the record	Inline: $IV_Sys, -SQL='SELECT * FROM ' $svSysTable ' WHERE ID = 1';		// If Found_Count is wrong, dump out 2000 "No Record Found"			If: (Found_Count) == 0;			Var:'vError' = '2000';			LI_ShowError3: -ErrNum=(Var:'vError'), -Option=(Var:'vOption');			Abort;		/If;		Var:'vSys_Domain' = Field:'Sys_Domain';		Var:'vSys_SMTP' = Field:'Sys_SMTP';		Var:'vSys_PostmasterEmail' = Field:'Sys_PostmasterEmail';		Var:'vSys_AdminEmail' = Field:'Sys_AdminEmail';		Var:'vSys_AuthUsername' = Field:'Sys_AuthUsername';		Var:'vSys_AuthPassword'=(Decrypt_Blowfish: -Seed=(Var:'svSalt'), (Field:'Sys_AuthPassword'));		Var:'vSys_WebserverRoot' = Field:'Sys_WebserverRoot';		Var:'vSys_PathToIm' = Field:'Sys_PathToIm';		Var:'vSys_PathToffmpeg' = Field:'Sys_PathToffmpeg';		Var:'vSys_PathToswftools' = Field:'Sys_PathToswftools';		Var:'vSys_PathToPassThru' = Field:'Sys_PathToPassThru';		Var:'vSys_Keywords' = Field:'Sys_Keywords';		Var:'vSys_Expires' = Field:'Sys_Expires';		Var:'vSys_Revisit' = Field:'Sys_Revisit';		Var:'vSys_Robots' = Field:'Sys_Robots';		Var:'vSys_Author' = Field:'Sys_Author';		Var:'vSys_Description' = Field:'Sys_Description';		Var:'vSys_Copyright' = Field:'Sys_Copyright';		Var:'vSys_Title' = Field:'Sys_Title';		Var:'vSys_Language' = Field:'Sys_Language';		Var:'vSys_UseFavIcon' = Field:'Sys_UseFavIcon';		Var:'vSys_DefaultTemplate' = Field:'Sys_DefaultTemplate';		Var:'vSys_DefaultStylesheet' = Field:'Sys_DefaultStylesheet';		Var:'vSys_GoogleTracker' = Field:'Sys_GoogleTracker';	/Inline;Else;	If: $svDebug == 'Y';		'32: vError = ' $vError '<br>\n';	/If;	// Update only if no error	If: $vError == '';		// Create the update query		Var:'SQLUpdateSys' = '			UPDATE ' $svSysTable ' SET			Sys_Domain = "'(Encode_SQL:(Var:'vSys_Domain'))'",			Sys_SMTP = "'(Encode_SQL:(Var:'vSys_SMTP'))'",			Sys_PostmasterEmail = "'(Encode_SQL:(Var:'vSys_PostmasterEmail'))'",			Sys_AdminEmail = "'(Encode_SQL:(Var:'vSys_AdminEmail'))'",\n';		// Optionally update AuthUsername and AuthPassword		If: $vSysAPW != '';					$SQLUpdateSys += '	Sys_AuthUsername = "'(Encode_SQL:(Var:'vSys_AuthUsername'))'",\n';			$SQLUpdateSys += '	Sys_AuthPassword = "'($vSysAPW)'",\n';		/If;		// Update Sys_WebserverRoot only for Superadmin		If($svUserPrivs_Priv == 'Superadmin');			$SQLUpdateSys += '	Sys_WebserverRoot = "'(Encode_SQL:(Var:'vSys_WebserverRoot'))'",';		/If;		$SQLUpdateSys += '	Sys_PathToIm = "'(Encode_SQL:(Var:'vSys_PathToIm'))'",		Sys_PathToffmpeg = "'(Encode_SQL:(Var:'vSys_PathToffmpeg'))'",		Sys_PathToswftools = "'(Encode_SQL:(Var:'vSys_PathToswftools'))'",		Sys_PathToPassThru = "'(Encode_SQL:(Var:'vSys_PathToPassThru'))'",		Sys_Keywords = "'(Encode_SQL:(Var:'vSys_Keywords'))'",		Sys_Expires = "'(Encode_SQL:(Var:'vSys_Expires'))'",		Sys_Revisit = "'(Encode_SQL:(Var:'vSys_Revisit'))'",		Sys_Robots = "'(Encode_SQL:(Var:'vSys_Robots'))'",		Sys_Author = "'(Encode_SQL:(Var:'vSys_Author'))'",		Sys_Description = "'(Encode_SQL:(Var:'vSys_Description'))'",		Sys_Copyright = "'(Encode_SQL:(Var:'vSys_Copyright'))'",		Sys_Title = "'(Encode_SQL:(Var:'vSys_Title'))'",		Sys_Language = "'(Encode_SQL:(Var:'vSys_Language'))'",		Sys_UseFavIcon = "'(Encode_SQL:(Var:'vSys_UseFavIcon'))'",		Sys_DefaultTemplate = "'(Encode_SQL:(Var:'vSys_DefaultTemplate'))'",		Sys_DefaultStylesheet = "'(Encode_SQL:(Var:'vSys_DefaultStylesheet'))'",		Sys_GoogleTracker = "'(Encode_SQL:(Var:'vSys_GoogleTracker'))'"		WHERE ID = 1';			// Update the record		Inline: $IV_Sys, -SQL=$SQLUpdateSys;				// If there is an error, dump out error 1012 "Update Failed"			// Otherwise dump out error "1014" System Settings Updated			If: (Error_CurrentError) != (Error_NoError);				Var:'vError' = '1012';				Var:'vOption' = (Error_CurrentError);			Else;				Var:'vError' = '1014';			/If;				If: $svDebug == 'Y';				'55: vError = ' $vError '<br>\n';				'55: Error_CurrentError = ' (Error_CurrentError) '<br>\n';				'55: SQLUpdateSys = ' $SQLUpdateSys '<br>\n';			/If;				/Inline;// Do new lookupInline: $IV_Sys, -SQL='SELECT * FROM ' $svSysTable ' WHERE ID = 1';	// If Found_Count is wrong, dump out 2000 "No Record Found"		If: (Found_Count) == 0;		Var:'vError' = '2000';			LI_ShowError3: -ErrNum=(Var:'vError'), -Option=(Var:'vOption');		Abort;	/If;	Var:'vSys_Domain' = Field:'Sys_Domain';	Var:'vSys_SMTP' = Field:'Sys_SMTP';	Var:'vSys_PostmasterEmail' = Field:'Sys_PostmasterEmail';	Var:'vSys_AdminEmail' = Field:'Sys_AdminEmail';	Var:'vSys_AuthUsername' = Field:'Sys_AuthUsername';	Var:'vSys_AuthPassword'=(Decrypt_Blowfish: -Seed=(Var:'svSalt'), (Field:'Sys_AuthPassword'));	Var:'vSys_WebserverRoot' = Field:'Sys_WebserverRoot';	Var:'vSys_PathToIm' = Field:'Sys_PathToIm';	Var:'vSys_PathToffmpeg' = Field:'Sys_PathToffmpeg';	Var:'vSys_PathToswftools' = Field:'Sys_PathToswftools';	Var:'vSys_PathToPassThru' = Field:'Sys_PathToPassThru';	Var:'vSys_Keywords' = Field:'Sys_Keywords';	Var:'vSys_Expires' = Field:'Sys_Expires';	Var:'vSys_Revisit' = Field:'Sys_Revisit';	Var:'vSys_Robots' = Field:'Sys_Robots';	Var:'vSys_Author' = Field:'Sys_Author';	Var:'vSys_Description' = Field:'Sys_Description';	Var:'vSys_Copyright' = Field:'Sys_Copyright';	Var:'vSys_Title' = Field:'Sys_Title';	Var:'vSys_Language' = Field:'Sys_Language';	Var:'vSys_UseFavIcon' = Field:'Sys_UseFavIcon';	Var:'vSys_DefaultTemplate' = Field:'Sys_DefaultTemplate';	Var:'vSys_DefaultStylesheet' = Field:'Sys_DefaultStylesheet';	Var:'vSys_GoogleTracker' = Field:'Sys_GoogleTracker';/Inline;	/If;/If;'<h2>'(LI_ShowIconByDataType)'&nbsp;&nbsp;System Settings</h2>\n';// Standard Error TableIf: (Var:'vError') != '';	LI_ShowError3: -ErrNum=(Var:'vError'), -Option=(Var:'vOption');/If;?> <form action="setup_addresponse.lasso" method="post"><h2 class="panelhead" onclick="exp_coll('4')"><img src="/site/images/bullet_downroundgreen.gif" width="20" height="24" id="image_4" alt="icon" title="Click to Toggle Panel" align="bottom"> Page Settings</h2><div id="sp_4" style="display:block;">	<table width="520">		<tr>			<td colspan="2" bgcolor="#333333" class="tablehead_10_white">Page-specific settings will override these</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Default Template[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc"><?Lassoscript// Default Page TemplateVar:'TemplatesArray' = (File_ListDirectory: ($svTmpltsPath));If: Var:'TemplatesArray' >> '.DS_Store';	$TemplatesArray->(Remove:1);/If;'\t\t\t<select name="Sys_DefaultTemplate" id="Sys_DefaultTemplate">\n';'\t\t\t\t<option value=""'; If: (Var:'vSys_DefaultTemplate') == ''; ' selected'; /If; '></option>\n';	Iterate: $TemplatesArray, (Local:'i');		'\t\t\t\t\t<option value="'(#i) '"'; If: (Var:'vSys_DefaultTemplate') == ($i); ' selected'; /If; '>'(#i)'</option>\n';	/Iterate;'\t\t\t</select>\n';?>			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Default Stylesheet[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc"><?Lassoscript// Default StylesheetVar:'CSSArray' = (File_ListDirectory: ($svCSSPath));If: Var:'CSSArray' >> '.DS_Store';	$CSSArray->(Remove:1);/If;'\t\t\t<select name="Sys_DefaultStylesheet" id="Sys_DefaultStylesheet">\n';'\t\t\t\t<option value=""'; If: (Var:'vSys_DefaultStylesheet') == ''; ' selected'; /If; '></option>\n';	Iterate: $CSSArray, (Local:'i');		If(!($svCSSIgnoreArray->Contains(#i)));			'\t\t\t\t\t<option value="'(#i) '"'; If: (Var:'vSys_DefaultStylesheet') == ($i); ' selected'; /If; '>'(#i)'</option>\n';		/If;	/Iterate;'\t\t\t</select>\n';?>			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Google Tracker</td>			<td valign="top" bgcolor="#cccccc">				<input type="text" name="Sys_GoogleTracker" id="Sys_GoogleTracker" value="[Var:'vSys_GoogleTracker']" size="14" maxlength="32"> 			</td>		</tr>	</table></div><h2 class="panelhead" onclick="exp_coll('3')"><img src="/site/images/bullet_rightroundyellow.gif" width="20" height="24" id="image_3" alt="icon" title="Click to Toggle Panel" align="bottom"> SEO Tailoring</h2><div id="sp_3" style="display:none;"><table width="520">		<tr>			<td colspan="2" bgcolor="#333333" class="tablehead_10_white">Page-specific settings will override these</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Keywords[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<textarea name="Sys_Keywords" id="Sys_Keywords" cols="45" rows="6">[Var:'vSys_Keywords']</textarea>			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Expires[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<input type="text" name="Sys_Expires" id="Sys_Expires" value="[Var:'vSys_Expires']" size="14" maxlength="32"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Revisit[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<input type="text" name="Sys_Revisit" id="Sys_Revisit" value="[Var:'vSys_Revisit']" size="14" maxlength="32"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Robots[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<input type="text" name="Sys_Robots" id="Sys_Robots" value="[Var:'vSys_Robots']" size="30" maxlength="255"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Author[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<input type="text" name="Sys_Author" id="Sys_Author" value="[Var:'vSys_Author']" size="48" maxlength="255"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Description[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<textarea name="Sys_Description" id="Sys_Description" cols="45" rows="6">[Var:'vSys_Description']</textarea>			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Copyright[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<input type="text" name="Sys_Copyright" id="Sys_Copyright" value="[Var:'vSys_Copyright']" size="48" maxlength="255"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Page Title[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<textarea name="Sys_Title" id="Sys_Title" cols="45" rows="2">[Var:'vSys_Title']</textarea>			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Language[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<select name="Sys_Language" id="Sys_Language">					<option value=""[If: (Var:'vSys_Language') == ''] selected[/If]></option>					<option value="en"[If: (Var:'vSys_Language') == 'en'] selected[/If]>English</option>					<option value="fr"[If: (Var:'vSys_Language') == 'fr'] selected[/If]>French</option>					<option value="de"[If: (Var:'vSys_Language') == 'de'] selected[/If]>German</option>					<option value="it"[If: (Var:'vSys_Language') == 'it'] selected[/If]>Italian</option>					<option value="sp"[If: (Var:'vSys_Language') == 'sp'] selected[/If]>Spanish</option>				</select>			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Use Favicon[$svInputRequired]</td>			<td valign="top" bgcolor="#cccccc">				<select name="Sys_UseFavIcon" id="Sys_UseFavIcon">					<option value="Y"[If: (Var:'vSys_UseFavIcon') == 'Y'] selected[/If]>Yes</option>					<option value="N"[If: (Var:'vSys_UseFavIcon') == 'N'] selected[/If]>No</option>				</select>			</td>		</tr>	</table></div><h2 class="panelhead" onclick="exp_coll('2')"><img src="/site/images/bullet_rightroundyellow.gif" width="20" height="24" id="image_2" alt="icon" title="Click to Toggle Panel" align="bottom"> Developer</h2><div id="sp_2" style="display:none;">	<table width="520">		<tr>			<td colspan="2"><strong>NOTE: </strong>[$svInputRequired] indicates required information.</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Domain[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_Domain" id="Sys_Domain" value="[Var:'vSys_Domain']" size="28" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">SMTP Server[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_SMTP" id="Sys_SMTP" value="[Var:'vSys_SMTP']" size="30" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Postmaster E-mail[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_PostmasterEmail" id="Sys_PostmasterEmail" value="[Var:'vSys_PostmasterEmail']" size="40" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Admin E-mail[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_AdminEmail" id="Sys_AdminEmail" value="[Var:'vSys_AdminEmail']" size="40" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Admin E-mail Auth. Username</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_AuthUsername" id="Sys_AuthUsername" value="[Var:'vSys_AuthUsername']" size="24" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Admin Email Auth. Password</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_AuthPassword" id="Sys_AuthPassword" value="[Var:'vSys_AuthPassword']" size="24" maxlength="128"> 			</td>		</tr><?Lassoscript// Display only to SuperadminsIf($svUserPrivs_Priv == 'Superadmin');?>		<tr>			<td width="180" class="tablehead_10_white_right">Webserver Root[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_WebserverRoot" id="Sys_WebserverRoot" value="[Var:'vSys_WebserverRoot']" size="60" maxlength="128"> 			</td>		</tr>[/If]		<tr>			<td width="180" class="tablehead_10_white_right">Path to ImageMagick[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_PathToIM" id="Sys_PathToIM" value="[Var:'vSys_PathToIm']" size="60" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Path to ffmpeg</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_PathToffmpeg" id="Sys_PathToffmpeg" value="[Var:'vSys_PathToffmpeg']" size="60" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Path to swftools</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_PathToswftools" id="Sys_PathToswftools" value="[Var:'vSys_PathToswftools']" size="60" maxlength="128"> 			</td>		</tr>		<tr>			<td width="180" class="tablehead_10_white_right">Path to PassThru</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Sys_PathToPassThru" id="Sys_PathToPassThru" value="[Var:'vSys_PathToPassThru']" size="60" maxlength="128"> 			</td>		</tr>	</table></div>	<table width="520">		<tr>			<td colspan="2" bgcolor="#666666">				<div align="center">					<input type="hidden" name="Process" value="Y">					<input type="hidden" name="DataType" value="[$vDataType]">					<input type="submit" name="Action" value="Update">				</div>			</td>		</tr>	</table></form>